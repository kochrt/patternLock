!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PatternLock=e()}(this,function(){"use strict";function p(){}function e(t){return t instanceof NodeList||t instanceof HTMLCollection?Array.prototype.slice.call(t):[t]}function P(n,i){if("string"==typeof i)return window.getComputedStyle(n)[i];Object.keys(i).forEach(function(t){var e=i[t];n.style[t]=e})}function s(e,t){var n=t.split(" ");1<n.length?n.forEach(function(t){return s(e,t)}):e.classList?e.classList.add(t):e.className+=" "+t}function r(e,t){var n=t.split(" ");1<n.length?n.forEach(function(t){return r(e,t)}):e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function a(t){e(t).forEach(function(t){t.parentNode.removeChild(t)})}function O(t,e,n,i){var r=e-t,a=i-n;return{length:Math.ceil(Math.sqrt(r*r+a*a)),angle:Math.round(180*Math.atan2(a,r)/Math.PI)}}function k(t,e){switch(t){case 1:return-1!==[2,4,5].indexOf(e);case 2:return-1!==[1,3,4,5,6].indexOf(e);case 3:return-1!==[2,5,6].indexOf(e);case 4:return-1!==[1,2,5,7,8].indexOf(e);case 5:return-1!==[1,2,3,4,6,7,8,9].indexOf(e);case 6:return-1!==[2,3,5,8,9].indexOf(e);case 7:return-1!==[4,5,8].indexOf(e);case 8:return-1!==[4,5,6,7,9].indexOf(e);case 9:return-1!==[5,6,8].indexOf(e)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t};function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var L=new WeakMap,c=(t(n,[{key:"getIdxFromPoint",value:function(t,e){var n=this.option,i=n.matrix,r=n.margin,a=t-this.wrapLeft,o=e-this.wrapTop,s=2*n.radius+2*r,l=Math.ceil(a/s),u=Math.ceil(o/s),c=a%s,h=o%s,d=null;return l<=i[1]&&u<=i[0]&&2*r<c&&2*r<h&&(d=(u-1)*i[1]+l),{idx:d,i:l,j:u,x:a,y:o}}},{key:"markPoint",value:function(t,e){s(t,"hovered"),this.patternAry.push(e),this.lastElm=t}},{key:"addLine",value:function(t){var e=this.patternAry,n=this.option,i=n.lineOnMove,r=n.margin,a=n.radius,o=(t.i-1)*(2*r+2*a)+2*r+a,s=(t.j-1)*(2*r+2*a)+2*r+a;if(1<e.length){var l=O(this.lineX1,o,this.lineY1,s),u=l.length,c=l.angle;P(this.line,{width:u+10+"px",transform:"rotate("+c+"deg)"}),i||P(this.line,{display:"block"})}var h=function(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]}('<div class="patt-lines" style="top:'+(s-5)+"px; left: "+(o-5)+'px;"></div>');this.line=h,this.lineX1=o,this.lineY1=s,this.holder.appendChild(h),i||P(this.line,{display:"none"})}},{key:"addDirectionClass",value:function(t){var e=this.lastElm,n=this.line,i=this.lastPosObj,r=[];if(0<t.j-i.j?r.push("s"):t.j-i.j<0&&r.push("n"),0<t.i-i.i?r.push("e"):t.i-i.i<0&&r.push("w"),r=r.join("-")){var a=r+" dir";s(e,a),s(n,a)}}}]),n);function n(){u(this,n),this.holder=null,this.option=null,this.mapperFunc=p,this.wrapLeft=0,this.wrapTop=0,this.disabled=!1,this.patternAry=[],this.lastPosObj=[],this.rightPattern=null,this.onSuccess=p,this.onError=p,this.pattCircle=null,this.lineX1=0,this.lineY1=0,this.line=null,this.lastPosObj=null}var o=(t(h,[{key:"getPattern",value:function(){var t=L.get(this),e=t.patternAry,n=t.option;return(e||[]).join(n.delimiter)}},{key:"setPattern",value:function(t){var e=L.get(this),n=e.option,i=n.matrix,r=n.margin,a=n.radius,o=n.enableSetPattern,s=n.delimiter;if(o){var l="string"==typeof t?t.split(s):t;this.reset(),e.wrapLeft=0;for(var u=e.wrapTop=0;u<l.length;u+=1){var c=l[u]-1,h=c%i[1]*(2*r+2*a)+2*r+a,d=Math.floor(c/i[1])*(2*r+2*a)+2*r+a;this._onMove.call(null,{clientX:h,clientY:d,preventDefault:p},this)}}}},{key:"enable",value:function(){L.get(this).disabled=!1}},{key:"disable",value:function(){L.get(this).disabled=!0}},{key:"reset",value:function(){var t=L.get(this);e(t.pattCircle).forEach(function(t){return r(t,"hovered dir s n w e s-w s-e n-w n-e")}),a(t.holder.querySelectorAll(".patt-lines")),t.patternAry=[],t.lastPosObj=null,r(t.holder,"patt-error")}},{key:"error",value:function(){s(L.get(this).holder,"patt-error")}},{key:"checkForPattern",value:function(t,e,n){var i=L.get(this);i.rightPattern=t,i.onSuccess=e||p,i.onError=n||p}},{key:"_render",value:function(){var t=L.get(this),e=t.option,n=t.holder,i=e.matrix,r=e.margin,a=e.radius,o='<ul class="patt-wrap" style="padding: '+r+'px">\n      '+Array.apply(void 0,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}({length:i[0]*i[1]})).map(this._renderCircle).join("")+"\n    </ul>";n.innerHTML=o,P(n,{width:i[1]*(2*a+2*r)+2*r+"px",height:i[0]*(2*a+2*r)+2*r+"px"}),t.pattCircle=t.holder.querySelectorAll(".patt-circ")}},{key:"option",value:function(t,e){var n=L.get(this).option;return void 0===e?n[t]:(n[t]=e,"margin"!==t&&"matrix"!==t&&"radius"!==t||this._render(),this)}}]),h);function h(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};u(this,h),d.call(this);var n=new c,i=document.querySelector(t);if(i&&0!==i.length){var r={onDraw:p},a=e.matrix;a&&9<a[0]*a[1]&&(r.delimiter=","),n.option=function(n){for(var t=arguments.length,e=Array(1<t?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return e.forEach(function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})}),n}({},h.defaults,r,e);var o=n.option.mapper;"object"===(void 0===o?"undefined":l(o))?n.mapperFunc=function(t){return o[t]}:n.mapperFunc="function"==typeof o?o:p,n.option.mapper=null,n.holder=i,L.set(this,n),this._render(),s(i,"patt-holder"),"static"===P(i,"position")&&P(i,{position:"relative"}),i.addEventListener("touchstart",this._onStart),i.addEventListener("mousedown",this._onStart)}}var d=function(){var E=this;this._onStart=function(t){t.preventDefault();var e=L.get(E),n=e.holder;if(!e.disabled){e.option.patternVisible||s(e.holder,"patt-hidden"),E.moveEvent="touchstart"===t.type?"touchmove":"mousemove",E.endEvent="touchstart"===t.type?"touchend":"mouseup",n.addEventListener(E.moveEvent,E._onMove),document.addEventListener(E.endEvent,E._onEnd);var i=e.holder.querySelector(".patt-wrap").getBoundingClientRect();e.wrapTop=i.top,e.wrapLeft=i.left,E.reset()}},this._onMove=function(t){t.preventDefault();var e=L.get(E),n=e.option,i=e.patternAry,r=t.clientX||t.touches[0].clientX,a=t.clientY||t.touches[0].clientY,o=e.pattCircle,s=e.getIdxFromPoint(r,a),l=s.idx,u=e.mapperFunc(l)||l;if(0<i.length){var c=O(e.lineX1,s.x,e.lineY1,s.y),h=c.length,d=c.angle;P(e.line,{width:h+10+"px",transform:"rotate("+d+"deg)"})}if(l&&(n.allowRepeat&&i[i.length-1]!==u||-1===i.indexOf(u))){var p=o[l-1];if(e.lastPosObj)for(var f=e.lastPosObj,v=0<s.i-f.i?1:-1,m=0<s.j-f.j?1:-1,y=f.i,g=f.j,b=Math.abs(s.i-y),x=Math.abs(s.j-g);0===b&&1<x||0===x&&1<b||x===b&&1<x;){y=b?y+v:y,g=x?g+m:g,b=Math.abs(s.i-y),x=Math.abs(s.j-g);var w=(g-1)*n.matrix[1]+y,j=e.mapperFunc(w)||w;(n.allowRepeat||-1===i.indexOf(j))&&k(f.idx,j)&&(e.addDirectionClass({i:y,j:g}),e.markPoint(o[j-1],j),e.addLine({i:y,j:g}))}e.lastPosObj&&e.addDirectionClass(s),e.markPoint(p,u),e.addLine(s),e.lastPosObj=s}},this._onEnd=function(t){t.preventDefault();var e=L.get(E),n=e.option,i=e.patternAry.join(n.delimiter);e.holder.removeEventListener(E.moveEvent,E._onMove),document.removeEventListener(E.endEvent,E._onEnd),r(e.holder,"patt-hidden"),i&&(a(e.line),n.onDraw(i),e.rightPattern&&(i===e.rightPattern?e.onSuccess():(e.onError(),E.error())))},this._renderCircle=function(){var t=L.get(E).option,e=t.margin,n=t.radius;return'<li \n      class="patt-circ"\n      style="margin: '+e+"px; width: "+2*n+"px; height: "+2*n+"px; border-radius: "+n+'px;"\n    >\n      <div class="patt-dots"></div>\n    </li>'}};return o.defaults={matrix:[3,3],margin:20,radius:25,patternVisible:!0,lineOnMove:!0,delimiter:"",enableSetPattern:!1,allowRepeat:!1},o});
